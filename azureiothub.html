<script type="text/javascript">
    RED.nodes.registerType('azureiothub',{
        category: 'cloud',
        color: '#00abec',
        defaults: {
            name: {value:"Azure IoT Hub"},
            protocol: {value:"amqp"}
        },
        inputs:1,
        outputs:1,
        icon: "azureiothub.png",
        label: function() {
            return this.name||"Azure IoT Hub";
        },
        paletteLabel: function(){
            return "Azure IoT Hub";
        },
        credentials: {
            hostname: {type:"text"}
        }
    });

    RED.nodes.registerType('azureiothubregistry',{
        category: 'cloud',
        color: '#00abec',
        defaults: {
            name: {value:"Azure IoT Hub Registry"}
        },
        inputs:1,
        outputs:1,
        icon: "azureiothub.png",
        label: function() {
            return this.name||"Azure IoT Hub Registry";
        },
        paletteLabel: function(){
            return "Azure IoT Hub Registry";
        },
        credentials: {
            connectionString: {type:"text"}
        }
    });

    RED.nodes.registerType('azureiothubreceiver',{
        category: 'cloud',
        color: '#00abec',
        defaults: {
            name: {value:"Azure IoT Hub Receiver"},
            lookback: { value: 0, validate: RED.validators.number(), required: false },
            consumerGroup: { value: "$Default", required: true }
        },
        inputs:0,
        outputs:1,
        icon: "azureiothub.png",
        label: function() {
            return this.name||"Azure IoT Hub Receiver";
        },
        paletteLabel: function(){
            return "Azure IoT Hub Receiver";
        },
        credentials: {
            connectionString: {type:"text", required: true}
        }
    });

    RED.nodes.registerType('azureiothubdevicetwin',{
        category: 'cloud',
        color: '#00abec',
        defaults: {
            name: {value:"Azure IoT Hub Device Twin"}
        },
        inputs:1,
        outputs:1,
        icon: "azureiothub.png",
        label: function() {
            return this.name||"Azure IoT Hub Device Twin";
        },
        paletteLabel: function(){
            return "Azure IoT Hub Device Twin";
        },
        credentials: {
            connectionString: {type:"text"}
        }
    });
</script>

<script type="text/x-red" data-template-name="azureiothub">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-protocol"><i class="icon-tag"></i> Protocol</label>
        <select id="node-input-protocol">
            <option>http</option>
            <option>amqp</option>
            <option>mqtt</option>
            <option>amqpWs</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-hostname"><i class="fa fa-bookmark"></i> Hostname</label>
        <input type="text" id="node-input-hostname">
    </div>
</script>

<script type="text/x-red" data-help-name="azureiothub">
    <p>A simple node that sends the message payloads to Azure IoT Hub</p>
</script>

<script type="text/x-red" data-template-name="azureiothubregistry">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-connectionString"><i class="fa fa-bookmark"></i> connectionString</label>
        <input type="text" id="node-input-connectionString">
    </div>
</script>

<script type="text/x-red" data-help-name="azureiothubregistry">
    <p>A simple node that registers devices with Azure IoT Hub</p>
</script>

<script type="text/x-red" data-help-name="azureiothubreceiver">
    <p>A simple node for receiving device-to-cloud messages via default Azure Events Hub endpoint.</p>
</script>

<script type="text/x-red" data-template-name="azureiothubreceiver">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-connectionString"><i class="fa fa-bookmark"></i> Connection String</label>
        <input type="text" id="node-input-connectionString">
    </div>
    <div class="form-row">
        <label for="node-input-consumerGroup"><i class="fa fa-group"></i> Consumer Group</label>
        <input type="text" id="node-input-consumerGroup" placeholder="$Default">
    </div>
    <div class="form-row">
        <label for="node-input-lookback"><i class="fa fa-clock-o"></i> Lookback</label>
        <input type="number" id="node-input-lookback" placeholder=0>
    </div>
	<div class="form-tips"><b>Tip:</b> By default, receiver starts to receive messages from the moment a connection is established. The <i>Lookback</i> parameter can be used to specify a time window from which messages are received from buffer before connection. For example, if the value is 60, upon initial connectivity, messages are received from the one minute period. This only applies to initial connection as the node internally tracks message offset to never lose messages in case of disconnections.</div>
</script>

<script type="text/x-red" data-help-name="azureiothubdevicetwin">
   <p>A simple node for retrieving Azure IoT Hub Device Twin(s).</p>
   <h3>Inputs</h3>
       <dl class="message-properties">
       <dt class="optional">payload
           <span class="property-type" >string</span>
       </dt>
       <dd>Optional deviceId specifier to retrieve only a specific Device Twin. If this property type is not defined or not a string, all Device Twins are retrieved.</dd>
   <h3>Outputs</h3>
       <dl class="message-properties">
       <dt class="optional">payload
           <span class="property-type">object</span>
       </dt>
       <dd>Retrieved Device Twin(s) as an array.</dd>
       <dt class="optional">error
           <span class="property-type">object</span>
       </dt>
       <dd>Error encountered. If present, <code>msg.payload</code> is always undefined.</dd>
   <h3>Details</h3>
   <p>Each input with produce an output with either <code>msg.error</code> as error object or <code>msg.payload</code> as an array of Device Twin data.</p>
</script>

<script type="text/x-red" data-template-name="azureiothubdevicetwin">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-connectionString"><i class="fa fa-bookmark"></i> connectionString</label>
        <input type="text" id="node-input-connectionString">
    </div>
</script>
